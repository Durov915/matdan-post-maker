<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>100% Matdan - SocialSparsh</title>
  <link rel="canonical" href="https://campaign.socialsparsh.com" />
  <link href="dist/output.css" rel="stylesheet">
  <!-- <link href="/dist/output.css" rel="stylesheet" /> -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Roboto&display=swap" rel="stylesheet">
  <!-- <link
      href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"
      rel="stylesheet"
    /> -->
  <link rel="stylesheet" href="npm/cropme-latest/dist/cropme.min.css">
  <script src="npm/cropme-latest/dist/cropme.min.js"></script>
  <script>
    document.fonts.load("1rem Roboto");
    document.fonts.load("1rem Roboto");
    let $bannerImg,
      $imgPreview,
      $imgPreviewContainer,
      actbtn,
      first_form,
      context,
      downloadable,
      imageInput;
    let cropme, hRatio, vRatio;
    let cropperInclude = true;
    //   let cropperInclude = true;
    let base_image = new Image();
    function addClassBasedOnScreenSize() {
      const body = document.querySelector("#first_class");
      if (window.innerWidth < 768) {
        body.classList.add("min-h-svh");
      } else {
        body.classList.remove("min-h-svh");
      }
    }
    function initialize() {
      $bannerImg = document.querySelector("#banner-img");
      $imgPreview = document.querySelector("#preview-canvas");
      $imgDownload = document.querySelector("#preview-canvas-download");
      $imgPreviewContainer = document.querySelector(
        "#preview-canvas-container"
      );
      $imgPreviewContainerDownload = document.querySelector(
        "#preview-canvas-container-download"
      );
      actbtn = document.querySelector("#btn-action-group");
      first_form = document.querySelector("#first_form");
      $imageEle = document.querySelector("#image-picker");
      context = $imgPreview.getContext("2d");
      downloadable = $imgDownload.getContext("2d");
      imageInput = document.querySelector("#dropzone-file");
      base_image.src = "100-matdan.jpg";
      //   base_image.src = "./assets/PostImage.jpeg";
      base_image.onload = function () {
        $imgPreview.setAttribute("width", base_image.width);
        $imgPreview.setAttribute("height", base_image.height);
        hRatio = $imgPreview.width / base_image.width;
        vRatio = $imgPreview.height / base_image.height;
        ratio = Math.min(hRatio, vRatio);
      };
      if (cropperInclude) {
        initializeCropme(153, 153);
        // initializeCropme(159, 159);
      }
      setupFormListener();
      addClassBasedOnScreenSize();
    }
    function toggleBorder(isError) {
      const imgInputContainer = document.querySelector(
        "#dropzone-file-container"
      );
      imgInputContainer?.classList.remove(
        isError ? "border-gray-300" : "border-red-500"
      );
      imgInputContainer?.classList.add(
        isError ? "border-red-500" : "border-gray-300"
      );
    }
    function initializeCropme(Width, Height) {
      const containerAspectRatio = Width / Height;
      const cropmeConfig = {
        container: {
          width: 290,
          height: 150,
        },
        viewport: {
          width: containerAspectRatio >= 1 ? 125 : 125 * containerAspectRatio,
          height: containerAspectRatio < 1 ? 125 : 125 / containerAspectRatio,
          type: "circle",
          //   type: "square",
          border: {
            width: 2,
            enable: true,
            color: "#fff",
          },
        },
        zoom: {
          enable: true,
          mouseWheel: true,
          slider: true,
          position: "right",
        },
        rotation: {
          slider: false,
          enable: false,
        },
        transformOrigin: "viewport",
      };
      const element = document.querySelector("#container");
      cropme = new Cropme(element, cropmeConfig);
      cropme.bind({
        url: "dist/user.png",
        // url: "dist/user.png",
      });
    }
    function sendAnalytics() {
      fetch("https://api.socialsparsh.com/CAMPVisitor", {
        //   fetch("https://api.socialsparsh.weybee.in/CAMPVisitor", {
        method: "POST",
        body: JSON.stringify({  
          txt1: document.querySelector("#text1")?.value || "",
          txt2: document.querySelector("#text2")?.value || "",
          txt3: document.querySelector("#text3")?.value || "",
          campDetailsId: 57,
          //   campDetailsId: 8,
          Referrer: document.referrer,
        }),
        headers: {
          "Content-type": "application/json; charset=UTF-8",
        },
      })
        .then((response) => response.json())
        .then((json) => console.log(json));
    }
    function calcRatio(value) {
      return (value * base_image.width) / 500;
    }
    function drawText(
      Text,
      x,
      y,
      fontSize,
      fontFamily,
      fontColor,
      textAlign,
      weight
    ) {
      const size = calcRatio(fontSize);
      context.textBaseline = "hanging";
      context.font = `${weight} ${size}px '${fontFamily}'`;
      context.fillStyle = fontColor;
      context.textAlign = textAlign;
      context.fillText(
        Text,
        calcRatio(x) + size / 10,
        calcRatio(y) + size / 10
      );
    }
    async function drawCroppedImage(output, base_image) {
      return new Promise((resolve, reject) => {
        imageSelected = true;
        const append_image = new Image();
        append_image.src = output;
        append_image.onload = function () {
          context.drawImage(append_image, calcRatio(299), calcRatio(332));
          //   context.drawImage(append_image, calcRatio(171), calcRatio(246));
          resolve();
        };
      });
    }
    function toggleElementVisibility() {
      [$imgPreviewContainer, $bannerImg, first_form, actbtn].forEach((el) =>
        el?.classList?.toggle("hidden")
      );
      window.scrollTo(0, 0);
    }
    function handleBack() {
      toggleElementVisibility();
      context.clearRect(0, 0, $imgPreview.width, $imgPreview.height);
    }
    function downloadCanvas() {
      const link = document.createElement("a");
      link.download = (document.querySelector('input[type="text"]')?.value || "100% Matdan") + ".jpeg";
      //   link.download =
      //     (document.querySelector('input[type="text"]')?.value || "GPBS 2024") +
      //     ".jpeg";
      link.href = $imgDownload.toDataURL("image/jpeg");
      link.click();
    }
    function shareCanvas() {
      $imgDownload.toBlob(async (blob) => {
        const file = new File(
          [blob],
          (document.querySelector('input[type="text"]')?.value || "100% Matdan") + ".jpeg",
          //   (document.querySelector('input[type="text"]')?.value ||
          //     "GPBS 2024") + ".jpeg",
          { type: blob.type }
        );
        await navigator.share({ files: [file] });
      });
    }
    function readURL(input) {
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function (e) {
          cropme.bind({
            url: e.target.result,
          });
          toggleBorder(false);
        };
        reader.readAsDataURL(input.files[0]);
      }
    }
    async function drawOnBaseImage(output) {
      await context.drawImage(
        base_image,
        0,
        0,
        base_image.width,
        base_image.height,
        0,
        0,
        base_image.width * ratio,
        base_image.height * ratio
      );
      if (cropperInclude) {
        await drawCroppedImage(output, base_image);
      }
      drawText(document.querySelector('#text1').value, 192, 444, 18, 'Roboto', '#fffbef', 'center', '');
      //   await drawText(
      //     document.querySelector("#text1").value,
      //     218,
      //     390,
      //     27,
      //     "Roboto",
      //     "#184294",
      //     "start",
      //     base_image
      //   );
      //   await drawText(
      //     document.querySelector("#text1").value,
      //     337,
      //     412,
      //     27,
      //     "Roboto",
      //     "#184294",
      //     "center",
      //     base_image
      //   );
      //   await drawText(
      //     document.querySelector("#text1").value,
      //     456,
      //     437,
      //     27,
      //     "Roboto",
      //     "#184294",
      //     "end",
      //     base_image
      //   );
      const download_image = new Image();
      download_image.src = $imgPreview.toDataURL("image/jpeg");
      download_image.onload = async function () {
        $imgDownload.setAttribute("width", download_image.width);
        $imgDownload.setAttribute("height", download_image.height);
        await downloadable.drawImage(download_image, 0, 0);
        if (false) {
          const size = calcRatio(10);
          downloadable.font = `bold ${size}px 'Roboto'`;
          downloadable.translate(
            download_image.width - (download_image.height * 1) / 100,
            download_image.height - (download_image.height * 10) / 100
          );
          downloadable.fillStyle = "#333333";
          downloadable.rotate(-Math.PI / 2);
          downloadable.fillText("SocialSparsh.com", 0, 0);
        }
      };
      toggleElementVisibility();
    }
    function setupFormListener() {
      first_form.addEventListener("submit", async (event) => {
        event.preventDefault();
        if (cropperInclude) {
          const imageBlank = imageInput.value === "";
          toggleBorder(imageBlank);
          if (!imageBlank) {
            cropme.crop({ width: calcRatio(153) }).then(async (output) => {
              // cropme.crop({ width: calcRatio(159) }).then(async (output) => {
              await drawOnBaseImage(output);
            });
            sendAnalytics();
          }
        } else {
          await drawOnBaseImage(null);
          sendAnalytics();
        }
      });
    }
    // Attach the load event listener
    window.addEventListener("load", initialize);
    window.addEventListener("resize", addClassBasedOnScreenSize);
  </script>
</head>

<body class="flex flex-col items-center bg-white md:bg-slate-100 justify-normal md:justify-center min-h-svh">
  <div id="first_class"
    class="w-full flex md:block flex-col justify-between md:justify-normal border-gray-200 rounded-none md:my-10 border-0 md:border md:rounded-lg shadow-transparent md:shadow-md sm:min-w-[512px] md:max-w-lg md:self-center">
    <div>
      <header>
        <h2 class="py-3 text-xl font-bold leading-9 tracking-tight text-center text-gray-900 bg-neutral-200">100% Matdan
        </h2>

        <div class="hidden" id="preview-canvas-container">
          <canvas id="preview-canvas" width="100%" class="w-full border">
          </canvas>
        </div>
        <div class="hidden" id="preview-canvas-container-download">
          <canvas id="preview-canvas-download" width="100%" class="w-full border">
          </canvas>
        </div>
      </header>
      <main class="flex flex-col h-auto justify-normal md:justify-center">
        <div class="block min-w-full mx-auto my-0 bg-white mx-w-full">
          <form class="p-3 space-y-4" id="first_form">
            <!-- <div style="display: none"> -->
            <div id="container"></div>
            <!-- </div> -->
            <div class="col-span-2" id="image-picker">
              <div class="flex items-center mt-2 gap-x-3">
                <div class="flex items-center justify-center w-full">
                  <label id="dropzone-file-container" for="dropzone-file"
                    class="flex flex-col items-center justify-center w-full h-24 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer md:h-32 bg-gray-50 hover:bg-gray-100">
                    <div class="flex flex-col items-center justify-center pt-2 pb-3 text-sm text-gray-500">
                      <span class="font-semibold">
                        Click Here to Upload Photo
                      </span>
                    </div>
                    <input id="dropzone-file" type="file" class="hidden" onchange="readURL(this)" name="image"
                      accept="image/png, image/jpg, image/jpeg">
                  </label>
                </div>
              </div>
            </div>
            <div class="col-span-2" id="Text1Div">
              <label for="text1" class="block mb-2 text-sm font-medium text-gray-900">Name</label>
              <div class="flex items-center mt-2 gap-x-3">
                <input type="text" id="text1"
                  class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5"
                  placeholder="Name" required="">
              </div>
            </div>
            <button type="submit"
              class="flex w-full justify-center rounded-md bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 text-sm font-semibold leading-6 shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">
              Upload Photo
            </button>
          </form>
          <div class="hidden p-5 row" role="group" id="btn-action-group">
            <div class="col">
              <button type="button" onclick="downloadCanvas()"
                class="w-full justify-center rounded-lg bg-indigo-600 hover:bg-indigo-500 text-white focus:ring-4 focus:outline-none font-medium text-sm px-5 py-2.5 text-center inline-flex items-center mr-2 mb-2">
                <svg class="w-3 h-3 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                  viewbox="0 0 20 20">
                  <path
                    d="M14.707 7.793a1 1 0 0 0-1.414 0L11 10.086V1.5a1 1 0 0 0-2 0v8.586L6.707 7.793a1 1 0 1 0-1.414 1.414l4 4a1 1 0 0 0 1.416 0l4-4a1 1 0 0 0-.002-1.414Z">
                  </path>
                  <path
                    d="M18 12h-2.55l-2.975 2.975a3.5 3.5 0 0 1-4.95 0L4.55 12H2a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2Zm-3 5a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z">
                  </path>
                </svg>
                Download
              </button>
            </div>
            <div class="flex justify-between">
              <button type="button" onclick="handleBack()"
                class="w-full justify-center rounded-lg bg-gray-600 hover:bg-gray-500 text-white focus:ring-4 focus:outline-none font-medium text-sm px-5 py-2.5 text-center inline-flex items-center mr-2 mb-2">
                <svg class="w-3 h-3 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                  viewbox="0 0 8 14">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M7 1 1.3 6.326a.91.91 0 0 0 0 1.348L7 13"></path>
                </svg>
                Back
              </button>
              <button type="button" onclick="shareCanvas()"
                class="w-full justify-center rounded-lg bg-green-600 hover:bg-green-500 text-white focus:ring-4 focus:outline-none font-medium text-sm px-5 py-2.5 text-center inline-flex items-center mb-2">
                <svg class="w-3 h-3 mr-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                  viewbox="0 0 18 18">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="m5.953 7.467 6.094-2.612m.096 8.114L5.857 9.676m.305-1.192a2.581 2.581 0 1 1-5.162 0 2.581 2.581 0 0 1 5.162 0ZM17 3.84a2.581 2.581 0 1 1-5.162 0 2.581 2.581 0 0 1 5.162 0Zm0 10.322a2.581 2.581 0 1 1-5.162 0 2.581 2.581 0 0 1 5.162 0Z">
                  </path>
                </svg>
                Share
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>
    <footer>
      <p class="p-3 text-sm text-center bg-neutral-200">
        Powered by
        <a target="_blank" href="#"
          class="font-semibold leading-6 text-indigo-600 hover:text-indigo-500">DHRUV THAKKAR</a>
      </p>
    </footer>
  </div>
 
</body>

</html>
